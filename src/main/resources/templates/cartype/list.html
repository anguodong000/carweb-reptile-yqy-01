<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!-- Bootstrap core CSS -->
	<link href="../public/bootstrap.min.css" title="" rel="stylesheet" />
	<link rel="stylesheet" href="../css/plugins/toastr/toastr.min.css" />
	<link href="../font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<!-- 时间控件样式 -->
	<link href="../css/plugins/datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
	<link href="../public/animate.css" rel="stylesheet">
	<link rel="stylesheet" href="../public/inspinia.css" />
	<link rel="stylesheet" href="../css/keHuGuanXi.css" />

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="../public/html5shiv.min.js"></script>
	<script src="../public/respond.min.js"></script>
	<![endif]-->
	<title>信息管理系统</title>
	<style>
		ul,li{
			margin:0;
			padding:0;
			list-style: none;
		}
		h2{
			font-size: 14px;
		}
		.right_b_table{
			width: 49%;
			float: right;
		}
		.liuCheng_list {
			margin-top: 20px;
		}
		.liuCheng_list li {
			overflow: hidden;
			font-size: 14px;
			padding: 0 0 0 4px;
			width: 191px;
			height: 45px;
		}
		.liuCheng_list p, .liuCheng_list dl, .liuCheng_list h1, .liuCheng_list h2 {
			float: left;
		}
		.liuCheng_list p {
			position: relative;
			width: 36px;
			height: 45px;
		}
		.liuCheng_list p .through {
			background: url(../img/m_icon.png) -70px -83px no-repeat;
		}

		.liuCheng_list p span {
			width: 14px;
			height: 14px;
			top: 0;
			left: 0;
		}
		.liuCheng_list p span, .liuCheng_list p strong {
			position: absolute;
		}
		.liuCheng_list p .green {
			background: #66d763;
		}
		.liuCheng_list p strong {
			width: 4px;
			height: 32px;
			top: 13px;
			left: 5px;
		}
		.liuCheng_list p span, .liuCheng_list p strong {
			position: absolute;
		}
		.liuCheng_list dt {
			overflow: hidden;
			margin-top: -6px;
		}
		.liuCheng_list h1 {
			max-width: 68px;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			font-size: 14px;
		}
		.liuCheng_list h2 {
			margin-left: 10px;
			color: #AAA;
		}
		.liuCheng_list dd {
			height: 16px;
			line-height: 16px;
			overflow: hidden;
			color: #AAA;
		}
		.liuCheng_list p .notapproval {
			background: url(../img/m_icon.png) -49px -83px no-repeat;
		}
		.huiFu-comments-input{
			padding: 10px 10px 0;
			position: relative;
		}
		.homepage-release-replay {
			border: 1px solid #ced1d6;
			border-radius: 3px;
			box-sizing: border-box;
			padding: 8px;
			padding-top: 6px;
			resize: none;
			width: 100%;
		}
		.crm-button-yellow {
			border-radius: 2px;
			color: #fff;
			background-color: #f39c12;
			cursor: pointer;
			padding: 0 20px;
			vertical-align: middle;
			display: inline-block;
			border: 1px solid #f39c12;
		}
		.homepage-release-replay-button {
			float: right;
			text-align: center;
			height: 25px !important;
			line-height: 25px !important;
		}
		.homepage-release-face-button {
			height: 25px;
			width: 25px;
			background: rgba(0,0,0,0) url(../img/view.png) no-repeat scroll -207px -148px;
			cursor: pointer;
			margin-right: 5px;
			float: left;
		}
		.homepage-replay-user {
			height: 20px;
			line-height: 20px;
			color: #0092da;
			white-space: nowrap;
		}
		.qqFace {
			margin-top: 4px;
			background: #fff;
			padding: 2px;
			border: 1px #dfe6f6 solid;
		}
		.qqFace table td img:hover {
			border: 1px #0066cc solid;
		}

		.qqFace table td img {
			cursor: pointer;
			border: 1px #fff solid;
		}
		.huiFu-comment-list>.huiFu-comments-input {
			display: none;
		}
		.big_huiFu{
			display: none;
		}
		#dialog{
			width: 100%;
			height:100%;
			position: absolute;
			top:0;
			background:#000;
			opacity: 0.5;
			z-index: 1;
			display: none;
		}
		.left_ins{
			width: 40%;
		}
		label{
			line-height:34px !important;
		}
	</style>
</head>

<body>
<div id="dialog"></div>
<div id="wrapper" class="container">
	<!--标编辑-->
	<div id="biaobj" class=" wrapper wrapper-content animated fadeInRight">
		<h3>车型管理</h3>
		<div class="right_box" id="right_box">
			<div class="tab_list">
				<ul class="tab_box">
					<li data-url="shangHaiWaiQin/Index.html" class="select_tab">车型信息</li>
					<!--<li data-url="shangHaiWaiQin/qianZaiKeHu.html">会修配件查询</li>
					<li data-url="shangHaiWaiQin/zhengShiKeHu.html">返修单查询</li>-->
				</ul>
				<button onclick="addCarType()" style="margin-left:10px;float: right;" type="button" class="btn btn-success"> <i class="fa fa-plus"></i> 添加</button>
			</div>
			<div class="top_tab_box">
				<div class="active">
					<!--上部表格部分-->
					<div id="top_table" class="ibox-content" style="border:none;">
						<div class="row">
							<div class="col-sm-12">
								<table class="table table-striped table-bordered table-hover dataTables-example">
									<thead id="carTypeTableHead">
										<tr>
											<th style='width:50px;text-align:center;vertical-align:middle;'>全选</th>
											<th style='width:60px;text-align:center;vertical-align:middle;'>车型Id</th>
											<th style='text-align:center;vertical-align:middle;'>车系</th>
											<th style='text-align:center;vertical-align:middle;'>品牌</th>
											<th style='text-align:center;vertical-align:middle;'>车型</th>
											<th style='text-align:center;vertical-align:middle;'>级别</th>
											<th style='text-align:center;vertical-align:middle;'>操作</th>
										</tr>
									</thead>
									<tbody id = "carTypeTable">
									<!-- 后台数据-->
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div id="totalDiv" class="col-sm-5">

							</div>
							<div style="height:27px;" class="col-sm-7">
								<div class="pagger-box pagger" id="editable_paginate">
									<!--<ul id="totalPageUl" class="pagination pull-right" style="margin:-3px 0;">
									 分页
									</ul>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 下部表格 -->
			<div class="tab_list">
				<ul class="tab_box">
					<li data-url="shangHaiWaiQin/Index.html" class="select_tab">车型详细信息</li>
				</ul>
				<button onclick="addCarTypeDetail()" style="margin-left:10px;float: right;" type="button" class="btn btn-success"> <i class="fa fa-plus"></i> 添加</button>
			</div>
			<div class="top_tab_box">
				<div class="active">
					<!--上部表格部分-->
					<div id="bottom_table" class="ibox-content" style="border:none;">
						<div class="row">
							<div class="col-sm-12">
								<table class="table table-striped table-bordered table-hover dataTables-example">
									<thead id="carTypeDetailHead">
									<!-- 下部表头-->
									</thead>
									<tbody id = "carTypeDetailTableData">
									<!-- 后台数据-->
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div id="carTypeDetailTotalDiv" class="col-sm-5">

							</div>
							<div style="height:27px;" class="col-sm-7">
								<div class="pagger-box pagger" id="carTypeDetailPaging">
									<!--<ul id="totalPageUl" class="pagination pull-right" style="margin:-3px 0;">
									 分页
									</ul>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<iframe id="ifr" src="/tabSwiper" frameborder="no" scrolling="no" width="780px" height="100%" allowtransparency="true"></iframe>
<script src="../public/jquery-1.11.3.js"></script>
<script src="../public/bootstrap.min.js" type="text/javascript"></script>
<script src="../js/plugins/lhgdialog/lhgdialog.js"></script>
<!-- 弹出警示框 -->
<script src="../js/plugins/toastr/toastr.min.js"></script>
<!-- 弹出确认框 -->
<script src="../public/artDialog4.1.7/artDialog.js?skin=blue"></script>
<script src="../public/artDialog4.1.7/plugins/iframeTools.js"></script>
<!-- 时间控件样式 -->
<script src="../js/plugins/datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="../js/plugins/datetimepicker/bootstrap-datetimepicker-update.min.js"></script>
<script src="../js/plugins/datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>

<script src="../js/templet_form.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=67jMQ5DmYTe1TLMBKFUTcZAR"></script>
<script type="text/javascript" src="../js/jquery.qqFace.js"></script>
<script src="../js/paging.js"></script>
<script>
	$(function() {
		carTypeList(1);
	});

	function carTypeList(currentPage){
		//alert("currentPage:"+currentPage);
		var param = {currentPage:currentPage};
		$.ajax({
			type:"POST",
			data:JSON.stringify(param),
			url:"/carType/list",
			contentType:"application/json",
			dataType:"json",
			success:function(data){
				console.log(data.data.carTypeList);
				$("#carTypeTable").empty();
				$("#totalDiv").empty();
				//总数
				var total = data.data.total;
				//总页数
				var totalPageNums = Math.ceil(total/20);
				//两侧显示的页码数 大于1
				var edges = 2;
				//主页码区显示的页码数 大于3
				var playes = 5;
				if(total==0){
					$('#editable_paginate').empty();
				}else{
					renderPageItem(totalPageNums,playes,edges,currentPage);
				}
				$("#totalDiv").append("<div class='dataTables_info' role='status' aria-live='polite'>总共"+data.data.total+"条,每页显示20条,共"+totalPageNums+"页</div>");
				$.each(data.data.carTypeList, function(i,item){
					$("#carTypeTable").append(
							"<tr id='carTypeRow"+item.id+"' name='carTypeRow'>" +
							//"<td style='width:50px;text-align:center;vertical-align:middle;'><input type='checkbox' onclick=\"carTypeDetailList('"+item.id+"','"+1+"')\" name='chk' value='"+item.id+"'></td>"+
							"<td style='width:50px;text-align:center;vertical-align:middle;'><input type='checkbox' name='chk' value='"+item.id+"'></td>"+
							"<td style='width:60px;text-align:center;vertical-align:middle;'><input type='hidden' name='carTypeId' value='"+item.id+"'>"+item.id+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.carLine+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.carBrand+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.carTypeName+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.level+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'><a href=\"javascript:carTypeDetailList('"+item.id+"','"+1+"')\">详情</a></td>"+
							"</tr>"
					);
				});
			}
		})
	}

	function carTypeDetailList(carTypeId,currentPage){
		var param = {carTypeId:carTypeId,currentPage:currentPage};
		$("tr[name='carTypeRow']").css("background-color", "");
		$("#carTypeRow" + carTypeId + "").css("background-color", "#01A9DB");
		$.ajax({
			type:"POST",
			data:JSON.stringify(param),
			url:"/carTypeDetail/list",
			contentType:"application/json",
			dataType:"json",
			success:function(data){
				console.log(data.data.carTypeDetailList);
				$("#carTypeDetailTableData").empty();
				$("#carTypeDetailTotalDiv").empty();
				$("#carTypeDetailHead").empty();
				$("#carTypeDetailHead").append("<tr>" +
						"<th style='width:50px;text-align:center;vertical-align:middle;'>全选</th>" +
						"<th style='width:80px;text-align:center;vertical-align:middle;'>车系详情Id</th>" +
						"<th style='text-align:center;vertical-align:middle;'>排量</th>" +
						"<th style='text-align:center;vertical-align:middle;'>进气形式</th>" +
						"<th style='text-align:center;vertical-align:middle;'>年限</th>" +
						"<th style='text-align:center;vertical-align:middle;'>环保标准</th>" +
						"<th style='text-align:center;vertical-align:middle;'>操作</th>"+
						"</tr>");
				//总数
				var total = data.data.total;
				//总页数
				var totalPageNums = Math.ceil(total/20);
				//两侧显示的页码数 大于1
				var edges = 2;
				//主页码区显示的页码数 大于3
				var playes = 5;
				if(total==0){
					$('#carTypeDetailPaging').empty();
				}else{
					renderPageItem(totalPageNums,playes,edges,currentPage);
				}
				$("#carTypeDetailTotalDiv").append("<div class='dataTables_info' role='status' aria-live='polite'>总共"+data.data.total+"条,每页显示20条,共"+totalPageNums+"页</div>");
				$.each(data.data.carTypeDetailList, function(i,item){
					$("#carTypeDetailTableData").append(
							"<tr>" +
							"<td style='width:50px;text-align:center;vertical-align:middle;'><input type='checkbox'></td>"+
							"<td style='width:80px;text-align:center;vertical-align:middle;'>"+item.id+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.displacement+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.inletModel+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.createYear+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'>"+item.environmentalStandards+"</td>"+
							"<td style='text-align:center;vertical-align:middle;'><a href=\"javascript:queryCarPartsInfo('"+item.carTypeId+"','"+item.id+"')\">添加配件</a>&nbsp;&nbsp;&nbsp;<a href=\"javascript:queryCarPartsByDetailId('"+item.carTypeId+"','"+item.id+"')\">配件详情</a></td>"+
							"</tr>"
					);
				});
			}
		})
	}

	function addCarType() {
		$.dialog({
			title: '添加车型',
			width: 600,
			height: 280,
			lock:true,
			content: 'url:/carType/addHtml',
			init: function() {
				//var ul = iframe.document.getElementById('right_list');
				var iframe = this.iframe.contentWindow;
			},
			button: [{
				name: '保存',
				callback: function() {
					var fd = new FormData();
					var iframe = this.iframe.contentWindow;
					var carLine = iframe.$("#carLine").val();
					var carBrand = iframe.$("#carBrand").val();
					var carTypeName = iframe.$("#carTypeName").val();
					var level = iframe.$("#level").val();

					var param = {carLine:carLine,carBrand:carBrand,carTypeName:carTypeName,level:level};
					console.log(param);
					$.ajax({
						url:"/carType/add",
						type:"post",
						data:JSON.stringify(param),
						contentType:"application/json",
						success:function(data){
							console.log(data);
							carTypeList(1);
						},
						error:function(e){
							console.log(e);
						}
					});
				},
				focus: true
			}, {
				name: '取消',
				callback: function() {

				}
			}]
		});
	}

	function addCarTypeDetail() {
		var length=$("input:checkbox[name='chk']:checked").length;
		if(length != 1){
			alert("请选中一个!");
		}else{
			var carTypeId = $("input:checkbox[name='chk']:checked").val();
			$.dialog({
				title: '添加车型详情',
				width: 600,
				height: 280,
				lock:true,
				content: 'url:/carTypeDetail/addDetailHtml',
				init: function() {
					//var ul = iframe.document.getElementById('right_list');
					var iframe = this.iframe.contentWindow;
				},
				button: [{
					name: '保存',
					callback: function() {
						var fd = new FormData();
						var iframe = this.iframe.contentWindow;
						var displacement = iframe.$("#displacement").val();
						var inletModel = iframe.$("#inletModel").val();
						var createYear = iframe.$("#createYear").val();
						var environmentalStandards = iframe.$("#environmentalStandards").val();

						var param = {carTypeId:carTypeId,displacement:displacement,inletModel:inletModel,createYear:createYear,environmentalStandards:environmentalStandards};
						console.log(param);
						$.ajax({
							url:"/carTypeDetail/add",
							type:"post",
							data:JSON.stringify(param),
							contentType:"application/json",
							success:function(data){
								console.log(data);
								carTypeDetailList(carTypeId,1);
							},
							error:function(e){
								console.log(e);
							}
						});
					},
					focus: true
				}, {
					name: '取消',
					callback: function() {
					}
				}]
			});
		}
	}

	function queryCarPartsInfo(carTypeId,carTypeDetailId) {
		/*alert("carTypeId:"+carTypeId);
		alert("carTypeDetailId:"+carTypeDetailId);*/
		var param = {carTypeId:carTypeId,carTypeDetailId:carTypeDetailId};
		$.dialog({
			title: '添加车型详情',
			width: 1100,
			height: 800,
			lock:true,
			content: 'url:/carType/queryCarPartsListHtml',
			data:JSON.stringify(param),
			init: function() {
				//var ul = iframe.document.getElementById('right_list');
				var iframe = this.iframe.contentWindow;
			},
			button: [{
				name: '保存',
				callback: function() {
					var fd = new FormData();
					var iframe = this.iframe.contentWindow;
					var carPartsIds = [];
					iframe.$('input[name="carPartsIds"]:checked').each(function(){//遍历每一个名字为nodes的复选框，其中选中的执行函数
						carPartsIds.push($(this).val());//将选中的值添加到数组carPartsIds中
					});
					var param = {carTypeId:carTypeId,carTypeDetailId:carTypeDetailId,carPartsIds:carPartsIds};
					console.log(param);
					$.ajax({
						url:"/carTypeDetail/addCarPartsInfo",
						type:"post",
						data:JSON.stringify(param),
						contentType:"application/json",
						success:function(data){
							console.log(data);
							//carTypeDetailList(carTypeId,1);
						},
						error:function(e){
							console.log(e);
							//alert(e);
						}
					});
				},
				focus: true
			}, {
				name: '取消',
				callback: function() {

				}
			}]
		});
	}

	function queryCarPartsByDetailId(carTypeId,carTypeDetailId) {
		var queryParam = {carTypeId:carTypeId,carTypeDetailId:carTypeDetailId};
		$.dialog({
			title: '车型配件列表',
			width: 1100,
			height: 800,
			lock:true,
			content: 'url:/carType/queryCarPartsByDetailIdHtml?carTypeId='+carTypeId+'&carTypeDetailId='+carTypeDetailId,
			init: function() {
				//var ul = iframe.document.getElementById('right_list');
				var iframe = this.iframe.contentWindow;
			}
		});
	}
</script>
</body>

</html>